<!DOCTYPE html>
<html>
<head>
  <title>API Request Example</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>Live Stock Prices</h1>



    <marquee class="stock-ticker" onmouseenter="stop()" onmouseleave="start()">
        <span class="stocks">
          <span class="name">SBI</span>
          <span class="price" id="s11"></span>
        </span>
        <span class="stocks">
            <span class="name">RELIANCE</span>
            <span class="price" id="s12"></span>
        </span>
        <span class="stocks">
            <span class="name">TATACONSUM</span>
            <span class="price" id="s13"></span>
        </span>
        <span class="stocks">
            <span class="name">JSW STEEL</span>
            <span class="price" id="s14"></span>
        </span>
        <span class="stocks">
            <span class="name">TATA STEEL</span>
            <span class="price" id="s15"></span>
        </span>
        <span class="stocks">
            <span class="name">NTPC</span>
            <span class="price" id="s16"></span>
        </span>
        <span class="stocks">
            <span class="name">POWERGRID</span>
            <span class="price" id="s17"></span>
        </span>
        <span class="stocks">
            <span class="name">BHARTIARTL</span>
            <span class="price" id="s18"></span>
        </span>
        <span class="stocks">
            <span class="name">BAJAFINSV</span>
            <span class="price" id="s19"></span>
        </span>
        <span class="stocks">
            <span class="name">BAJFINANCE</span>
            <span class="price" id="s20"></span>
        </span>
        <span class="stocks">
            <span class="name">HEROMOTOCO</span>
            <span class="price" id="s21"></span>
        </span>
        <span class="stocks">
            <span class="name">HDFCBANK</span>
            <span class="price" id="s22"></span>
        </span>
        <span class="stocks">
            <span class="name">KOTAKBANK</span>
            <span class="price" id="s23"></span>
        </span>
        <span class="stocks">
            <span class="name">TCS</span>
            <span class="price" id="s24"></span>
        </span>

        <span class="stocks">
            <span class="name">INFY</span>
            <span class="price" id="s25"></span>
        </span>

        <span class="stocks">
            <span class="name">HINDALCO</span>
            <span class="price" id="s26"></span>
        </span>
        <span class="stocks">
            <span class="name">ADANIPOWER</span>
            <span class="price" id="s27"></span>
        </span>

        <span class="stocks">
            <span class="name">ASIANPAINT</span>
            <span class="price" id="s28"></span>
        </span>
        <span class="stocks">
            <span class="name">APLAPOLLO</span>
            <span class="price" id="s29"></span>
        </span>

        <span class="stocks">
            <span class="name">NESTLEIND</span>
            <span class="price" id="s30"></span>
        </span>
        <span class="stocks">
            <span class="name">ITC</span>
            <span class="price" id="s31"></span>
        </span>
        <span class="stocks">
            <span class="name">ONGC</span>
            <span class="price" id="s32"></span>
        </span>
        <span class="stocks">
            <span class="name">SUNPHARMA</span>
            <span class="price" id="s33"></span>
        </span>
        <span class="stocks">
            <span class="name">GRASIM</span>
            <span class="price" id="s34"></span>
        </span>
        <span class="stocks">
            <span class="name">DIVISLAB</span>
            <span class="price" id="s35"></span>
        </span>
        <span class="stocks">
            <span class="name">DRREDDY</span>
            <span class="price" id="s36"></span>
        </span>
        <span class="stocks">
            <span class="name">HCLTECH</span>
            <span class="price" id="s37"></span>
        </span>
        <span class="stocks">
            <span class="name">WIPRO</span>
            <span class="price" id="s38"></span>
        </span>
        <span class="stocks">
            <span class="name">BRITANNIA</span>
            <span class="price" id="s39"></span>
        </span>
        <span class="stocks">
            <span class="name">CIPLA</span>
            <span class="price" id="s40"></span>
        </span>
        <span class="stocks">
            <span class="name">EICHERMOT</span>
            <span class="price" id="s41"></span>
        </span>
        <span class="stocks">
            <span class="name">MARUTI</span>
            <span class="price" id="s42"></span>
        </span>

        <span class="stocks">
            <span class="name">MAHINDCIE</span>
            <span class="price" id="s43"></span>
        </span>
        <span class="stocks">
            <span class="name">HINDMOTORS</span>
            <span class="price" id="s44"></span>
        </span>
        <span class="stocks">
            <span class="name">BPCL</span>
            <span class="price" id="s45"></span>
        </span>
        <span class="stocks">
            <span class="name">COALINDIA</span>
            <span class="price" id="s46"></span>
        </span>
        <span class="stocks">
            <span class="name">TECHM</span>
            <span class="price" id="s47"></span>
        </span>
        <span class="stocks">
            <span class="name">HINDUNILVR</span>
            <span class="price" id="s48"></span>
        </span>
        <span class="stocks">
            <span class="name">ADANIGREEN</span>
            <span class="price" id="s49"></span>
        </span>
        <span class="stocks">
            <span class="name">ADANIENT</span>
            <span class="price" id="s50"></span>
        </span>

        <span class="stocks">
            <span class="name">ZOMATO</span>
            <span class="price" id="s51"></span>
        </span>
        <span class="stocks">
            <span class="name">PIDILITIND</span>
            <span class="price" id="s52"></span>
        </span>
        <span class="stocks">
            <span class="name">HAVELLS</span>
            <span class="price" id="s53"></span>
        </span>
        <span class="stocks">
            <span class="name">DABUR</span>
            <span class="price" id="s54"></span>
        </span>
        <span class="stocks">
            <span class="name">SHREECEM</span>
            <span class="price" id="s55"></span>
        </span>
        <span class="stocks">
            <span class="name">IRCTC</span>
            <span class="price" id="s56"></span>
        </span>
        <span class="stocks">
            <span class="name">LICI</span>
            <span class="price" id="s57"></span>
        </span>
        <span class="stocks">
            <span class="name">MOTHERSON</span>
            <span class="price" id="s58"></span>
        </span>
        <span class="stocks">
            <span class="name">BAJAJHLDNG</span>
            <span class="price" id="s59"></span>
        </span>
        <span class="stocks">
            <span class="name">BOSCHLTD</span>
            <span class="price" id="s60"></span>
        </span>
      </marquee>

      <h1>Live NSE Indices</h1>
      <style>
        .wrapper{
            display: flex;
            align-items: center;
            justify-content: space-evenly;
            flex-wrap: wrap
        }
        .conatiner{
            border: 2px solid black;
            border-radius: 10px;
            padding: 1rem;
        }
      </style>
     <div class="wrapper">
        <div class="container">
            <div>NIFTY</div>
            <div class="price" id="s1">
            </div>
        </div>
        <div class="container">
            <div>NIFTY NEXT 50</div>
            <div class="price" id="s2">
            </div>
        </div>
        <div class="container">
            <div>NIFTY MIDCAP 100</div>
            <div class="price" id="s3">
            </div>
        </div>
        <div class="container">
            <div>NIFTY BANK</div>
            <div class="price" id="s4">
            </div>
        </div>
        <div class="container">
            <div>NIFTY FINANCIAL SERVICES</div>
            <div class="price" id="s5">
            </div>
        </div>
        <div class="container">
            <div>NIFTY 100</div>
            <div class="price" id="s6">
            </div>
        </div>
        <div class="container">
            <div>NIFTY SMALLCAP 100</div>
            <div class="price" id="s7">
            </div>
        </div>
        <div class="container">
            <div>INDIA VIX</div>
            <div class="price" id="s8">
            </div>
        </div>
        <div class="container">
            <div>NIFTY 200</div>
            <div class="price" id="s9">
            </div>
        </div>
        <div class="container">
            <div>NIFTY 500</div>
            <div class="price" id="s10">
            </div>
        </div>
     </div> 

  <script>
var requests = [
    
    //first 10 requests starts    
    {  exchange: "NSE",
        tradingsymbol: "NIFTY",
        symboltoken: "26000",
        },
        {  exchange: "NSE",
        tradingsymbol: "Nifty Next 50",
        symboltoken: "26013",
        },
        {  exchange: "NSE",
        tradingsymbol: "NIFTY MIDCAP 100",
        symboltoken: "99926011",
        },
        {  exchange: "NSE",
        tradingsymbol: "Nifty Bank",
        symboltoken: "26009",
        },
        {  exchange: "NSE",
        tradingsymbol: "Nifty Fin Service",
        symboltoken: "26037",
        },    {  exchange: "NSE",
        tradingsymbol: "Nifty 100",
        symboltoken: "99926012",
        },    {  exchange: "NSE",
        tradingsymbol: "NIFTY SMLCAP 100",
        symboltoken: "99926032",
        },    {  exchange: "NSE",
        tradingsymbol: "India VIX",
        symboltoken: "99926017",
        },    {  exchange: "NSE",
        tradingsymbol: "Nifty 200",
        symboltoken: "99926033",
        },    {  exchange: "NSE",
        tradingsymbol: "Nifty 500",
        symboltoken: "26004",
        },
    
    //first 10 requests ends   
    //second 10 request starts
    {  exchange: "NSE",
        tradingsymbol: "SBIN-EQ",
        symboltoken: "3045",
        },{
        exchange: "NSE",
        tradingsymbol: "RELIANCE-EQ",
        symboltoken: "2885",
      }, {
        exchange: "NSE",
        tradingsymbol: "TATACONSUM",
        symboltoken: "3432",
      },  {
        exchange: "NSE",
        tradingsymbol: "JSWSTEEL-EQ",
        symboltoken: "11723",
      },  {
        exchange: "NSE",
        tradingsymbol: "TATASTEEL-EQ",
        symboltoken: "3499",
      },  {
        exchange: "NSE",
        tradingsymbol: "NTPC-EQ",
        symboltoken: "11630",
      },  {
        exchange: "NSE",
        tradingsymbol: "POWERGRID-EQ",
        symboltoken: "14977",
      },  {
        exchange: "NSE",
        tradingsymbol: "BHARTIARTL-EQ",
        symboltoken: "10604",
      },  {
        exchange: "NSE",
        tradingsymbol: "BAJAFINSV-EQ",
        symboltoken: "16675",
      },  {
        exchange: "NSE",
        tradingsymbol: "BAJFINANCE-EQ",
        symboltoken: "317",
      },  
    
    
    
    //second 10 requests ends
    
    //third 10 requests starts
    {
        exchange: "NSE",
        tradingsymbol: "HEROMOTOCO-EQ",
        symboltoken: "1348",
      },  
      {
        exchange: "NSE",
        tradingsymbol: "HDFCBANK-EQ",
        symboltoken: "1333",
      },
      {
        exchange: "NSE",
        tradingsymbol: "KOTAKBANK-EQ",
        symboltoken: "1922",
      },
      {
        exchange: "NSE",
        tradingsymbol: "TCS-EQ",
        symboltoken: "11536",
      },
      {
        exchange: "NSE",
        tradingsymbol: "INFY-EQ",
        symboltoken: "1594",
      },
      {
        exchange: "NSE",
        tradingsymbol: "HINDALCO-EQ",
        symboltoken: "1363",
      },
      {
        exchange: "NSE",
        tradingsymbol: "ADANIPOWER-EQ",
        symboltoken: "17388",
      },
      {
        exchange: "NSE",
        tradingsymbol: "ASIANPAINT-EQ",
        symboltoken: "236",
      },
      {
        exchange: "NSE",
        tradingsymbol: "APLAPOLLO-EQ",
        symboltoken: "25780",
      },
      {
        exchange: "NSE",
        tradingsymbol: "NESTLEIND-EQ",
        symboltoken: "17963",
      },
      
    //third 10 requests ends
    
    //fourth 10 requests starts
    {
        exchange: "NSE",
        tradingsymbol: "ITC-EQ",
        symboltoken: "1660",
      },
      {
        exchange: "NSE",
        tradingsymbol: "ONGC-EQ",
        symboltoken: "2475",
      },
    
      {
        exchange: "NSE",
        tradingsymbol: "SUNPHARMA-EQ",
        symboltoken: "3351",
      },
      {
        exchange: "NSE",
        tradingsymbol: "GRASIM-EQ",
        symboltoken: "1232",
      },
      {
        exchange: "NSE",
        tradingsymbol: "DIVISLAB-EQ",
        symboltoken: "10940",
      },
      {
        exchange: "NSE",
        tradingsymbol: "DRREDDY-EQ",
        symboltoken: "881",
      },
    
      {
        exchange: "NSE",
        tradingsymbol: "HCLTECH-EQ",
        symboltoken: "7229",
      },{
        exchange: "NSE",
        tradingsymbol: "WIPRO-EQ",
        symboltoken: "3787",
      },{
        exchange: "NSE",
        tradingsymbol: "BRITANNIA-EQ",
        symboltoken: "547",
      },{
        exchange: "NSE",
        tradingsymbol: "CIPLA-EQ",
        symboltoken: "694",
      },
    
    //fourth 10 requests ends
    //fifth 10 requests starts
    {
        exchange: "NSE",
        tradingsymbol: "EICHERMOT-EQ",
        symboltoken: "910",
      },
    {  exchange: "NSE",
        tradingsymbol: "MARUTI-EQ",
        symboltoken: "10999",
        },
        {  exchange: "NSE",
        tradingsymbol: "MAHINDCIE-EQ",
        symboltoken: "14937",
        },
        {  exchange: "NSE",
        tradingsymbol: "HINDMOTORS-EQ",
        symboltoken: "21676",
        },
        {  exchange: "NSE",
        tradingsymbol: "BPCL-EQ",
        symboltoken: "526",
        },
        {  exchange: "NSE",
        tradingsymbol: "COALINDIA-EQ",
        symboltoken: "20374",
        },
        {  exchange: "NSE",
        tradingsymbol: "TECHM-EQ",
        symboltoken: "13538",
        },
        {  exchange: "NSE",
        tradingsymbol: "HINDUNILVR-EQ",
        symboltoken: "1394",
        },
        {  exchange: "NSE",
        tradingsymbol: "ADANIGREEN-EQ",
        symboltoken: "3563",
        },
        {  exchange: "NSE",
        tradingsymbol: "ADANIENT-EQ",
        symboltoken: "25",
        },
        
    //fifth 10 requests ends

 
    //sixth 10 requests starts

 
    {  exchange: "NSE",
        tradingsymbol: "ZOMATO-EQ",
        symboltoken: "5097",
        },
        {  exchange: "NSE",
        tradingsymbol: "PIDILITIND-EQ",
        symboltoken: "2664",
        },
        {  exchange: "NSE",
        tradingsymbol: "HAVELLS-EQ",
        symboltoken: "9819",
        },
        {  exchange: "NSE",
        tradingsymbol: "DABUR-EQ",
        symboltoken: "772",
        },
        {  exchange: "NSE",
        tradingsymbol: "SHREECEM-EQ",
        symboltoken: "3103",
        },    {  exchange: "NSE",
        tradingsymbol: "IRCTC-EQ",
        symboltoken: "13611",
        },    {  exchange: "NSE",
        tradingsymbol: "LICI-EQ",
        symboltoken: "9480",
        },    {  exchange: "NSE",
        tradingsymbol: "MOTHERSON-EQ",
        symboltoken: "4204",
        },    {  exchange: "NSE",
        tradingsymbol: "BAJAJHLDNG-EQ",
        symboltoken: "305",
        },    {  exchange: "NSE",
        tradingsymbol: "BOSCHLTD-EQ",
        symboltoken: "2181",
        },

    //sixth 10 requests ends
    ];

function makeRequestBatch(batch, startIndex) {
  var configArray = batch.map((req, index) => ({
    method: 'post',
    url: 'https://apiconnect.angelbroking.com/order-service/rest/secure/angelbroking/order/v1/getLtpData',
    headers: {
        'Authorization': 'Bearer eyJhbGciOiJIUzUxMiJ9.eyJ1c2VybmFtZSI6IlA1Mjk3NzQiLCJyb2xlcyI6MCwidXNlcnR5cGUiOiJVU0VSIiwiaWF0IjoxNjg2ODc5Mjk1LCJleHAiOjE2ODY5NjU2OTV9.qig_gko0JxuKfVrqGQXzgGQDT44qvFkhlB2QtXd4mWmrzdCLjxA64CMT2_AU_5s_IN7W3ch5qWIqnqVCtL3Tzw',
        'Content-Type': 'application/json',
        'Accept': 'application/json',
        'X-UserType': 'USER',
        'X-SourceID': 'WEB',
        'X-ClientLocalIP': 'CLIENT_LOCAL_IP',
        'X-ClientPublicIP': 'CLIENT_PUBLIC_IP',
        'X-MACAddress': 'MAC_ADDRESS',
        'X-PrivateKey': 'erZDHFHD'
      },

    data: JSON.stringify(req),
    index: startIndex + index,
  }));

  var responses = configArray.map((config) => axios(config));

axios
  .all(responses)
  .then(
    axios.spread((...responses) => {
      responses.forEach((response) => {
        if (response.data.data && response.data.data.tradingsymbol) {
          var stockData = response.data.data.ltp;
          var index = response.config.index;
          updateHTML(stockData, index);
        } else {
          console.log("Invalid response: " + JSON.stringify(response.data));
        }
      });
    })
  )
  .catch((error) => {
    console.log(error);
  });
}

var ltpValues = {};

function updateHTML(stockData, index) {
  var displayElement = document.getElementById("s" + index);
  if (displayElement) {
    var token = stockData.tradingsymbol;
    var ltp = stockData.ltp;
    
    // Save the ltp value
    ltpValues[token] = ltp;
    
    displayElement.textContent = ltp;

    console.log(ltpValues[token])
  }
}


function makeRequestsInBatches(requests, batchSize, delay) {
var index = 0;

function makeNextBatch() {
  var batch = requests.slice(index, index + batchSize);
  var startIndex = index + 1;
  index += batchSize;

  makeRequestBatch(batch, startIndex);

  if (index >= requests.length) {
    index = 0;
  }

  setTimeout(makeNextBatch, delay);
}

makeNextBatch();
}

makeRequestsInBatches(requests, 10, 2000);
  </script> 
      
</body>
</html>
